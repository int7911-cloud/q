# Sistema de Control de Estacionamiento

Sistema web completo para la gestiÃ³n de estacionamiento con control de ingreso/egreso de vehÃ­culos, generaciÃ³n de cÃ³digos QR, cÃ¡lculo automÃ¡tico de tarifas y gestiÃ³n de clientes mensuales.

## ğŸš€ CaracterÃ­sticas

- âœ… **Registro de ingreso** con patente y tipo de vehÃ­culo
- âœ… **GeneraciÃ³n automÃ¡tica de cÃ³digo QR** Ãºnico por vehÃ­culo
- âœ… **Escaneo de QR** para procesar salidas
- âœ… **CÃ¡lculo automÃ¡tico de tarifas** (por hora, fraccionado cada media hora)
- âœ… **GeneraciÃ³n de tickets/comprobantes** imprimibles
- âœ… **GestiÃ³n de clientes mensuales** (patente, modelo, telÃ©fono, vencimiento)
- âœ… **DiferenciaciÃ³n de tarifas** entre autos y motos
- âœ… **Sistema multi-usuario** (4 operadores de garita)
- âœ… **Interfaz web responsive** (funciona en PC y mÃ³vil)
- âœ… **Panel de estado** en tiempo real
- âœ… **Reportes diarios** con estadÃ­sticas

## ğŸ“‹ Tarifas

### Autos ğŸš—
- Primera hora: $500
- Cada media hora adicional: $250

### Motos ğŸï¸
- Primera hora: $300
- Cada media hora adicional: $150

### Clientes Mensuales
- Sin cargo (ingreso libre hasta la fecha de vencimiento)

## ğŸ› ï¸ InstalaciÃ³n

### Prerrequisitos
- Python 3.8 o superior
- pip (gestor de paquetes de Python)

### Paso 1: Clonar el repositorio
```bash
git clone https://github.com/DiegoRafaelRamosLlanos/Estacionamiento.git
cd Estacionamiento
```

### Paso 2: Crear entorno virtual
```bash
# En Windows
python -m venv venv
venv\Scripts\activate

# En Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### Paso 3: Instalar dependencias
```bash
pip install -r requirements.txt
```

### Paso 4: Inicializar la base de datos
```bash
python init_db.py
```

Este comando crearÃ¡:
- La base de datos SQLite (`app.db`)
- 4 usuarios operadores
- 2 clientes mensuales de ejemplo

### Paso 5: Ejecutar la aplicaciÃ³n
```bash
python run.py
```

La aplicaciÃ³n estarÃ¡ disponible en: `http://127.0.0.1:5000`

## ğŸ‘¥ Usuarios de Prueba

| Usuario | ContraseÃ±a | Nombre |
|---------|------------|---------|
| operador1 | 1234 | Juan PÃ©rez |
| operador2 | 1234 | MarÃ­a GarcÃ­a |
| operador3 | 1234 | Carlos LÃ³pez |
| operador4 | 1234 | Ana MartÃ­nez |

## ğŸ“± Uso del Sistema

### 1. Ingreso de VehÃ­culos
1. Iniciar sesiÃ³n con credenciales de operador
2. Ir a **"Ingreso"** en el menÃº
3. Ingresar patente y seleccionar tipo de vehÃ­culo
4. Hacer clic en **"Registrar Ingreso"**
5. Se generarÃ¡ un cÃ³digo QR Ãºnico
6. Imprimir o mostrar el QR al cliente

### 2. Salida de VehÃ­culos
1. Ir a **"Salida"** en el menÃº
2. Escanear el cÃ³digo QR o ingresar ID/patente manualmente
3. El sistema calcularÃ¡ automÃ¡ticamente el costo
4. Se generarÃ¡ un ticket con todos los datos
5. Imprimir el ticket como comprobante

### 3. GestiÃ³n de Clientes Mensuales
1. Ir a **"Mensuales"** en el menÃº
2. Completar el formulario con los datos del cliente:
   - Patente
   - Modelo del vehÃ­culo
   - TelÃ©fono
   - Tipo de vehÃ­culo
   - Fecha de vencimiento
3. Los clientes mensuales ingresan sin cargo

### 4. Monitoreo en Tiempo Real
1. Ir a **"Estado"** para ver vehÃ­culos activos
2. Se muestra tiempo transcurrido y costo estimado
3. La pÃ¡gina se actualiza automÃ¡ticamente cada 30 segundos

### 5. Reportes
1. Ir a **"Reportes"** para ver estadÃ­sticas del dÃ­a:
   - Total de vehÃ­culos
   - RecaudaciÃ³n total
   - VehÃ­culos activos
   - Historial completo

## ğŸ—‚ï¸ Estructura del Proyecto

```
Estacionamiento/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py           # InicializaciÃ³n de la app Flask
â”‚   â”œâ”€â”€ auth.py               # Rutas de autenticaciÃ³n
â”‚   â”œâ”€â”€ routes.py             # Rutas principales
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ models.py         # Modelos de base de datos
â”‚   â”œâ”€â”€ templates/            # Plantillas HTML
â”‚   â”‚   â”œâ”€â”€ base.html
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ entry.html
â”‚   â”‚   â”œâ”€â”€ exit.html
â”‚   â”‚   â”œâ”€â”€ monthly.html
â”‚   â”‚   â”œâ”€â”€ status.html
â”‚   â”‚   â”œâ”€â”€ reports.html
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â””â”€â”€ login.html
â”‚   â””â”€â”€ static/               # Archivos estÃ¡ticos (CSS, JS, imÃ¡genes)
â”œâ”€â”€ config.py                 # ConfiguraciÃ³n de la aplicaciÃ³n
â”œâ”€â”€ requirements.txt          # Dependencias del proyecto
â”œâ”€â”€ init_db.py               # Script de inicializaciÃ³n de BD
â”œâ”€â”€ run.py                   # Punto de entrada de la aplicaciÃ³n
â””â”€â”€ README.md                # Este archivo
```

## ğŸ”§ ConfiguraciÃ³n Avanzada

### Variables de Entorno
Crear un archivo `.env` en la raÃ­z del proyecto:

```env
SECRET_KEY=tu-clave-secreta-aqui
DATABASE_URL=sqlite:///app.db
FLASK_ENV=development
```

### Cambiar Tarifas
Editar en `app/routes.py`, funciÃ³n `vehicle_exit()`:

```python
if vehicle.type == 'auto':
    first_hour_rate = 500  # Cambiar aquÃ­
    half_hour_rate = 250   # Cambiar aquÃ­
else:  # moto
    first_hour_rate = 300  # Cambiar aquÃ­
    half_hour_rate = 150   # Cambiar aquÃ­
```

### Base de Datos MySQL (ProducciÃ³n)
Para usar MySQL en lugar de SQLite:

1. Instalar PyMySQL:
```bash
pip install PyMySQL
```

2. Configurar en `.env`:
```env
DATABASE_URL=mysql+pymysql://usuario:contraseÃ±a@localhost/estacionamiento
```

## ğŸ“Š Modelos de Datos

### User (Usuario)
- `id`: ID Ãºnico
- `username`: Nombre de usuario
- `password_hash`: ContraseÃ±a encriptada
- `name`: Nombre completo

### Vehicle (VehÃ­culo)
- `id`: ID Ãºnico
- `plate`: Patente
- `type`: Tipo (auto/moto)
- `entry_time`: Hora de ingreso
- `exit_time`: Hora de salida
- `qr_code`: CÃ³digo QR (base64)
- `is_monthly`: Â¿Es cliente mensual?
- `total_cost`: Costo total
- `operator_name`: Operador que registrÃ³ ingreso
- `exit_operator_name`: Operador que registrÃ³ salida

### MonthlyClient (Cliente Mensual)
- `id`: ID Ãºnico
- `plate`: Patente
- `model`: Modelo del vehÃ­culo
- `phone`: TelÃ©fono
- `vehicle_type`: Tipo (auto/moto)
- `expiration_date`: Fecha de vencimiento
- `created_at`: Fecha de registro

## ğŸ› SoluciÃ³n de Problemas

### Error: "No module named 'flask'"
```bash
pip install -r requirements.txt
```

### Error: "Database not found"
```bash
python init_db.py
```

### Error: "Port already in use"
Cambiar el puerto en `run.py`:
```python
app.run(debug=True, port=5001)
```

### Resetear la base de datos
```bash
rm app.db
python init_db.py
```

## ğŸ“ Notas Importantes

- Los cÃ³digos QR se almacenan en formato base64 en la base de datos
- La aplicaciÃ³n funciona sin conexiÃ³n a internet (excepto para cargar Bootstrap y jQuery desde CDN)
- Se recomienda hacer backups periÃ³dicos de `app.db`
- Para producciÃ³n, cambiar `SECRET_KEY` y desactivar modo debug

## ğŸš€ Despliegue en ProducciÃ³n

### Usando Gunicorn
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 "app:create_app()"
```

### Usando Docker (opcional)
Crear `Dockerfile`:
```dockerfile
FROM python:3.9
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:8000", "app:create_app()"]
```

## ğŸ“„ Licencia

Este proyecto es de cÃ³digo abierto y estÃ¡ disponible para uso libre.

## ğŸ‘¨â€ğŸ’» Autor

Diego Rafael Ramos Llanos

## ğŸ¤ Contribuciones

Las contribuciones son bienvenidas. Por favor:
1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## ğŸ“ Soporte

Para reportar problemas o sugerencias, abrir un issue en GitHub.

---

**Â¡Gracias por usar el Sistema de Control de Estacionamiento!** ğŸš—ğŸï¸